<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>×™×¦×™×¨×ª ×©×™×¨ ×‘-AI</title>
<style>
body {
  font-family: Arial;
  background: #0f1220;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

.box {
  background: #161a2f;
  padding: 25px;
  border-radius: 12px;
  width: 380px;
  text-align: center;
}

textarea {
  width: 100%;
  height: 80px;
  border-radius: 8px;
  border: none;
  padding: 10px;
  resize: none;
}

button {
  margin-top: 10px;
  padding: 10px;
  width: 100%;
  border: none;
  border-radius: 8px;
  background: #4f7cff;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

#status {
  margin-top: 10px;
}

audio {
  margin-top: 15px;
  width: 100%;
}
</style>
</head>
<body>

<div class="box">
  <h2>ğŸ¶ ×™×¦×™×¨×ª ×©×™×¨ ×¢× AI</h2>
  <textarea id="prompt" placeholder="×›×ª×•×‘ ×›××Ÿ ××™×š ××ª×” ×¨×•×¦×” ×©×”×©×™×¨ ×™×™×©××¢..."></textarea>
  <button onclick="createSong()">×¦×•×¨ ×©×™×¨</button>
  <div id="status"></div>
  <audio id="player" controls></audio>
</div>

<script>
const API_KEY = "×›××Ÿ_×”××¤×ª×—_×©×œ×š";
const CREATE_URL = "×›××Ÿ_×›×ª×•×‘×ª_×™×¦×™×¨×”";
const STATUS_URL = "×›××Ÿ_×›×ª×•×‘×ª_×‘×“×™×§×ª_×¡×˜×˜×•×¡";

async function createSong() {
  const prompt = document.getElementById("prompt").value;
  const status = document.getElementById("status");
  status.innerText = "ğŸ”„ ×©×•×œ×— ×‘×§×©×” ×œ×™×¦×™×¨×”...";

  const res = await fetch(CREATE_URL, {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + API_KEY,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      prompt: prompt,
      instrumental: false
    })
  });

  const data = await res.json();
  const taskId = data.task_id || data.taskId;

  status.innerText = "â³ ×™×•×¦×¨ ×©×™×¨...";

  checkStatus(taskId);
}

async function checkStatus(taskId) {
  const status = document.getElementById("status");

  const interval = setInterval(async () => {
    const res = await fetch(`${STATUS_URL}?task_id=${taskId}`, {
      headers: {
        "Authorization": "Bearer " + API_KEY"
      }
    });

    const data = await res.json();

    if (data.status === "completed") {
      clearInterval(interval);
      status.innerText = "âœ… ×”×©×™×¨ ××•×›×Ÿ!";

      const audioBlob = base64ToBlob(data.audio_base64, "audio/mpeg");
      const audioUrl = URL.createObjectURL(audioBlob);

      document.getElementById("player").src = audioUrl;
    }

    if (data.status === "failed") {
      clearInterval(interval);
      status.innerText = "âŒ ×”×™×¦×™×¨×” × ×›×©×œ×”";
    }
  }, 5000);
}

function base64ToBlob(base64, type) {
  const bytes = atob(base64);
  let arr = new Uint8Array(bytes.length);
  for (let i = 0; i < bytes.length; i++) {
    arr[i] = bytes.charCodeAt(i);
  }
  return new Blob([arr], { type });
}
</script>

</body>
</html>
